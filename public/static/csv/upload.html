<div class="row-fluid">
 <strong> Test File </strong>
  <ol>
   <li>
    <a href="static/test_files/1.csv">ถ้ำลอด - ข้อมูลผู้ป่วย_รพสต.ถ้ำลอด</a>
   </li>
   <li>
    <a href="static/test_files/2.csv">โรงเรียนราชประชา 44 ปางมะผ้า - สศศ.</a>
   </li>
  </ol>
</div>

<div class="row-fluid">
  <div class="span12">    
    <!--
    <div ng-include="'static/csv/header.html'"></div>
    -->
    <div class="row-fluid">
     <div class="span6 well"> 
      <div class="row-fluid">
       <form class="form-inline pull-left"  
        id="file_upload_form" 
        method="post" enctype="multipart/form-data" 
        action="csv/upload" 
        target="upload_target" class="form-horizontal">
        <div class="btn-group">
            Select File     
            <input type="file" name="file" 
              id="file" 
              onchange="angular.element(this).scope().setFile(this)"/>
          <button type="submit" 
            ng-disabled="theFile==null"
            class="btn btn-primary start">
           <i class="icon-upload icon-white"></i>Upload
          </button>                
        </div>                         
       </form>
      </div> 

      <div class="row-fluid">
        <span ng-show="theFile">
          <!-- {{theFile.name}}--> 
         <span ng-show = "data.csv">จำนวน</span> 
         <span ng-show = "data.csv" 
            class="label label-success">{{data.csv.length}}</span>  
         <span ng-show = "data.csv">แถว</span> 
        </span>
      </div>
     </div>
 
     <div class="span6 well" ng-show = "data.csv">
       <!--List of Function-->
      <div class="row-fluid" ng-show="theFile">
       <div class="input-append">
        <select ng-model="type" class="span8 input-medium" 
         ng-options="a.name for a in mapping_schema">
        </select>
        <button class="btn btn-success" ng-click="test()">Run</button>
       </div>
      </div>
      <div class="row-fluid" ng-show="theFile">
       <div class = "alert alert-info">
        <b>คำเตือน!</b> กรุณาเลือกประเภทฟังก์ชั่นตามประเภทของไฟล์ 
       </div>
      </div>
      <div class="row-fluid">
        {{type.description}}
      </div>
     </div>
    </div>
        <!--Result-->
    <div class="row-fluid">
      <span ng-switch on="success">
       <span ng-switch-when="true">
        <span class="label label-success" ng-show="total_docs>0">
         {{saved_doc}}/{{total_docs}} document saved.
        </span> 
        <br>
        <span class="label label-important" ng-show="failed_doc > 0">
         {{failed_doc}} error while saving document.
        </span>
       </span>          
       <span ng-switch-when="false">
        <i class="icon-info-sign"></i>
         There are error of uploading file.
       </span>          
      </span>
    </div>
    
    <!--Result MSSQL-->
    <div class="row-fluid">
     <div class="span6" ng-show="success_list.length>0">
      <p class="lead">Success List  {{success_list.length}}</p>
      <table class="table table-condensed">
       <tr ng-repeat="doc in success_list">
       
        <td ng-repeat="cols in doc.json">
         <h3>{{doc.table_name()}}</h3>
         <ul>
          <li ng-repeat="content in cols" ng-show="content.value">
           {{content.metadata.colName}} = 
           {{content.value}}
          </li>
         </ul>
        </td>
       </tr>
      </table>
     </div>

     <div class="span6" ng-show="fail_list.length>0">
       <p class="lead">Fail List  {{fail_list.length}}</p>
       <table class="table table-condensed">
        <tr ng-repeat="fail in fail_list">
         <td>
          <ul class="unstyled">
           <li ng-repeat="(key,value) in fail">
            {{key}} = {{value.value}}
           </li>
          </ul>
         </td>
        </tr>
       </table>
     </div>
    </div>

    <!--CSV-->
    <div class="row-fluid">
     <h3 ng-show = "data.csv">Source: CSV Content</h3>
    </div>
    <div class="row-fluid">
     <table class="table table-condensed">
      <tr ng-repeat="row in data.csv">
       <td>
        <span ng-repeat="(key,value) in row">
          <span class="text-info">{{key}}</span> {{value.value}}
        </span>
       </td>
      </tr>
     </table>
    </div>

  </div> <!---span12-->
</div>

<iframe id="upload_target" 
    name="upload_target" 
    style="width:0;height:0;border:0px solid #fff;">
</iframe>
